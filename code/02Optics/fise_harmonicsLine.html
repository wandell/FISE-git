<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2025a"><title>Movie of Summing 2D Harmonics to Create a Line Impulse</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(192, 76, 11); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { border-left: 0px none rgb(33, 33, 33); border-right: 0px none rgb(33, 33, 33); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px; line-height: 15.6px; min-height: 16px; white-space: pre; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;  }
.CodeBlock { background-color: #F5F5F5; margin: 10px 15px 10px 0; display: inline-block; min-width: 100%; }
.S2 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S3 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>Movie of Summing 2D Harmonics to Create a Line Impulse</span></h1><div class = 'preformatted-plain' style = 'margin: 10px 3px 10px 55px; padding: 10px 10px 10px 5px; '><div  class = 'S1'><span style="white-space: pre"><span >publish('fise_harmonicsLine.m', 'html');</span></span></div></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >N = 129; </span><span style="color: rgb(0, 128, 19);">% Number of samples in each dimension (e.g., 129x129 image)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% 1. Define the spatial grid for the 2D image</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >x_spatial = linspace(-pi, pi, N); </span><span style="color: rgb(0, 128, 19);">% X-coordinates for plotting</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >y_spatial = linspace(-pi, pi, N); </span><span style="color: rgb(0, 128, 19);">% Y-coordinates for plotting</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >[X_grid_spatial, Y_grid_spatial] = meshgrid(x_spatial, y_spatial);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Create 0-indexed spatial indices grids for the DFT formula (n_x, n_y)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% These are crucial for the (k*n/N) part of the exponential argument.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >n_indices_1D = 0:(N-1); </span><span style="color: rgb(0, 128, 19);">% Base 0-indexed vector</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >[n_x_grid, n_y_grid] = meshgrid(n_indices_1D, n_indices_1D); </span><span style="color: rgb(0, 128, 19);">% 2D grids of 0-indexed spatial positions</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% 2. Define the discrete impulse line</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% This creates a vertical line impulse at the 65th column (center for N=129).</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% In 0-indexed terms, this corresponds to n_x = (N-1)/2 = 64.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >discrete_impulse_line = zeros(N, N);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >center_column_idx = (N + 1) / 2; </span><span style="color: rgb(0, 128, 19);">% For N=129, this is 65</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >discrete_impulse_line(:, center_column_idx) = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% 3. Compute the 2D DFT coefficients of this impulse line</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% IMPORTANT: Because the line is SHIFTED from n_x=0, these coefficients</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% will be COMPLEX. They will also only be non-zero along the k_y=0 (first)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% row, as a vertical line has no variation in the y-frequency domain.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >DFT_coefficients_2D = fft2(discrete_impulse_line);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Initialize the 2D image that will accumulate the harmonics.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% It must be initialized with complex zeros because intermediate sums will be complex.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >accumulated_harmonics_2D = zeros(N, N);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- Movie Setup ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Define the output video file name and format</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >outputVideoFile = </span><span style="color: rgb(167, 9, 245);">'line_impulse_build_up_2D_movie.mp4'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >writerObj = VideoWriter(outputVideoFile, </span><span style="color: rgb(167, 9, 245);">'MPEG-4'</span><span >); </span><span style="color: rgb(0, 128, 19);">% Using MPEG-4 for good compression</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >writerObj.FrameRate = 15; </span><span style="color: rgb(0, 128, 19);">% Set desired frames per second (e.g., 10 or 15)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Open the video writer object</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >open(writerObj);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Setup the figure for plotting each frame</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hFig = figure; </span><span style="color: rgb(0, 128, 19);">% Create a new figure window</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >set(hFig, </span><span style="color: rgb(167, 9, 245);">'Position'</span><span >, [100 100 800 600]); </span><span style="color: rgb(0, 128, 19);">% Optional: Set figure size [left bottom width height]</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hAx = gca; </span><span style="color: rgb(0, 128, 19);">% Get the current axes handle for consistent plotting</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >colormap(hFig, </span><span style="color: rgb(167, 9, 245);">'gray'</span><span >); </span><span style="color: rgb(0, 128, 19);">% Set colormap to grayscale for clear visualization of intensity</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'Creating movie "%s"... This may take a few moments.\n'</span><span >, outputVideoFile);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- Summation and Movie Frame Capture Loop ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% For a vertical line impulse, only the k_y=0 (first row) of the 2D DFT coefficients</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% `DFT_coefficients_2D` will be non-zero.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Thus, we only need to loop through the x-frequency components (k_x or 'fx_val').</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% The loop goes from 0 up to N-1 for fx_val.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >frames_per_harmonic_step = 1; </span><span style="color: rgb(0, 128, 19);">% Capture a frame for every harmonic added</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">for </span><span >fx_val = 0:(N-1) </span><span style="color: rgb(0, 128, 19);">% Loop through x-frequency components (k_x index)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Get the DFT coefficient for the current x-frequency and y-frequency = 0.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% MATLAB uses 1-based indexing, so k_freq=0 is index 1.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% DFT_coefficients_2D(k_x_index + 1, k_y_index + 1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    current_DFT_coeff = DFT_coefficients_2D(fx_val + 1, 1); </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Calculate the current 2D harmonic component using the complex DFT coefficient</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% and the complex exponential. This component is applied across the entire 2D grid.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Note the use of '.*' for element-wise multiplication.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    current_harmonic_component = current_DFT_coeff .* exp(1j * 2 * pi * fx_val * n_x_grid / N);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Add the current harmonic component to the accumulated sum</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    accumulated_harmonics_2D = accumulated_harmonics_2D + current_harmonic_component;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% --- Plotting and Frame Capture for the current frame ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Capture a frame every 'frames_per_harmonic_step' or for the very last harmonic.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">if </span><span >mod(fx_val, frames_per_harmonic_step) == 0 || fx_val == (N-1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% Apply the overall 1/(N*N) scaling factor required for a 2D Inverse DFT.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% We take the real part because the original impulse line is real;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% any tiny imaginary parts are due to floating-point precision errors.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        current_frame_data = real(accumulated_harmonics_2D / (N*N)); </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% The impulse line is already correctly positioned by the IDFT sum</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% (which handles the shift from its DFT coefficients).</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% So, no additional circshift is needed here for plotting.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        imagesc(hAx, x_spatial, y_spatial, current_frame_data); </span><span style="color: rgb(0, 128, 19);">% Display the 2D image</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% Set consistent axis properties for stable visualization in the movie</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        axis(hAx, </span><span style="color: rgb(167, 9, 245);">'xy'</span><span >, </span><span style="color: rgb(167, 9, 245);">'equal'</span><span >, </span><span style="color: rgb(167, 9, 245);">'tight'</span><span >); </span><span style="color: rgb(0, 128, 19);">% 'xy' for standard image orientation, 'equal' aspect ratio, 'tight' limits</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        colorbar(hAx); </span><span style="color: rgb(0, 128, 19);">% Show colorbar</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% Set consistent colorbar limits across all frames.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% A unit impulse peak is 1. Sidelobes can go slightly negative (Gibbs phenomenon).</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        caxis(hAx, [-0.2 1.1]); </span><span style="color: rgb(0, 128, 19);">% Adjusted to accommodate slight undershoots and overshoot</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% Update the plot title to show current progress (number of harmonics added)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        title(hAx, sprintf(</span><span style="color: rgb(167, 9, 245);">'Summing 2D Harmonics: Frequencies Added = %d (fx from 0 to %d)'</span><span >, fx_val + 1, fx_val));</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        xlabel(hAx, </span><span style="color: rgb(167, 9, 245);">'Spatial X-coordinate (radians)'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        ylabel(hAx, </span><span style="color: rgb(167, 9, 245);">'Spatial Y-coordinate (radians)'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        drawnow; </span><span style="color: rgb(0, 128, 19);">% Force MATLAB to update the figure window immediately</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% Capture the current figure as a frame</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        frame = getframe(hFig);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% Write the captured frame to the video file</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >        writeVideo(writerObj, frame);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- Finalize Movie ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >close(writerObj); </span><span style="color: rgb(0, 128, 19);">% Close the video writer object</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'Movie creation complete. File saved as: %s\n'</span><span >, outputVideoFile);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- Optional: Display the final reconstructed impulse line in a separate figure ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% This plot shows the final state of the summation, identical to the last frame of the movie.</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >figure; </span><span style="color: rgb(0, 128, 19);">% Create a new figure for the final plot</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >final_impulse_image = real(accumulated_harmonics_2D / (N*N)); </span><span style="color: rgb(0, 128, 19);">% Final scaling and taking real part</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >imagesc(x_spatial, y_spatial, final_impulse_image);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >axis </span><span style="color: rgb(167, 9, 245);">xy equal tight</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >colorbar;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >title([</span><span style="color: rgb(167, 9, 245);">'Final Reconstructed 1D Impulse Line (N=' </span><span >num2str(N) </span><span style="color: rgb(167, 9, 245);">' Harmonics)'</span><span >]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >xlabel(</span><span style="color: rgb(167, 9, 245);">'Spatial X-coordinate (radians)'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >ylabel(</span><span style="color: rgb(167, 9, 245);">'Spatial Y-coordinate (radians)'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >caxis([-0.2 1.1]); </span><span style="color: rgb(0, 128, 19);">% Match movie's colorbar limits</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'Maximum value of final reconstructed image: %f\n'</span><span >, max(final_impulse_image(:)));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'Minimum value of final reconstructed image (excluding peak): %f\n'</span><span >, min(final_impulse_image(final_impulse_image &lt; 0.5)));</span></span></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Movie of Summing 2D Harmonics to Create a Line Impulse
%%
% 
%  publish('fise_harmonicsLine.m', 'html');
%

N = 129; % Number of samples in each dimension (e.g., 129x129 image)

% 1. Define the spatial grid for the 2D image
x_spatial = linspace(-pi, pi, N); % X-coordinates for plotting
y_spatial = linspace(-pi, pi, N); % Y-coordinates for plotting
[X_grid_spatial, Y_grid_spatial] = meshgrid(x_spatial, y_spatial);

% Create 0-indexed spatial indices grids for the DFT formula (n_x, n_y)
% These are crucial for the (k*n/N) part of the exponential argument.
n_indices_1D = 0:(N-1); % Base 0-indexed vector
[n_x_grid, n_y_grid] = meshgrid(n_indices_1D, n_indices_1D); % 2D grids of 0-indexed spatial positions

% 2. Define the discrete impulse line
% This creates a vertical line impulse at the 65th column (center for N=129).
% In 0-indexed terms, this corresponds to n_x = (N-1)/2 = 64.
discrete_impulse_line = zeros(N, N);
center_column_idx = (N + 1) / 2; % For N=129, this is 65
discrete_impulse_line(:, center_column_idx) = 1;

% 3. Compute the 2D DFT coefficients of this impulse line
% IMPORTANT: Because the line is SHIFTED from n_x=0, these coefficients
% will be COMPLEX. They will also only be non-zero along the k_y=0 (first)
% row, as a vertical line has no variation in the y-frequency domain.
DFT_coefficients_2D = fft2(discrete_impulse_line);

% Initialize the 2D image that will accumulate the harmonics.
% It must be initialized with complex zeros because intermediate sums will be complex.
accumulated_harmonics_2D = zeros(N, N);

% REPLACE_WITH_DASH_DASH- Movie Setup REPLACE_WITH_DASH_DASH-
% Define the output video file name and format
outputVideoFile = 'line_impulse_build_up_2D_movie.mp4';
writerObj = VideoWriter(outputVideoFile, 'MPEG-4'); % Using MPEG-4 for good compression
writerObj.FrameRate = 15; % Set desired frames per second (e.g., 10 or 15)

% Open the video writer object
open(writerObj);

% Setup the figure for plotting each frame
hFig = figure; % Create a new figure window
set(hFig, 'Position', [100 100 800 600]); % Optional: Set figure size [left bottom width height]
hAx = gca; % Get the current axes handle for consistent plotting
colormap(hFig, 'gray'); % Set colormap to grayscale for clear visualization of intensity

fprintf('Creating movie "%s"... This may take a few moments.\n', outputVideoFile);

% REPLACE_WITH_DASH_DASH- Summation and Movie Frame Capture Loop REPLACE_WITH_DASH_DASH-
% For a vertical line impulse, only the k_y=0 (first row) of the 2D DFT coefficients
% `DFT_coefficients_2D` will be non-zero.
% Thus, we only need to loop through the x-frequency components (k_x or 'fx_val').
% The loop goes from 0 up to N-1 for fx_val.

frames_per_harmonic_step = 1; % Capture a frame for every harmonic added

for fx_val = 0:(N-1) % Loop through x-frequency components (k_x index)

    % Get the DFT coefficient for the current x-frequency and y-frequency = 0.
    % MATLAB uses 1-based indexing, so k_freq=0 is index 1.
    % DFT_coefficients_2D(k_x_index + 1, k_y_index + 1)
    current_DFT_coeff = DFT_coefficients_2D(fx_val + 1, 1); 

    % Calculate the current 2D harmonic component using the complex DFT coefficient
    % and the complex exponential. This component is applied across the entire 2D grid.
    % Note the use of '.*' for element-wise multiplication.
    current_harmonic_component = current_DFT_coeff .* exp(1j * 2 * pi * fx_val * n_x_grid / N);
    
    % Add the current harmonic component to the accumulated sum
    accumulated_harmonics_2D = accumulated_harmonics_2D + current_harmonic_component;
    
    % REPLACE_WITH_DASH_DASH- Plotting and Frame Capture for the current frame REPLACE_WITH_DASH_DASH-
    % Capture a frame every 'frames_per_harmonic_step' or for the very last harmonic.
    if mod(fx_val, frames_per_harmonic_step) == 0 || fx_val == (N-1)
        % Apply the overall 1/(N*N) scaling factor required for a 2D Inverse DFT.
        % We take the real part because the original impulse line is real;
        % any tiny imaginary parts are due to floating-point precision errors.
        current_frame_data = real(accumulated_harmonics_2D / (N*N)); 
        
        % The impulse line is already correctly positioned by the IDFT sum
        % (which handles the shift from its DFT coefficients).
        % So, no additional circshift is needed here for plotting.

        imagesc(hAx, x_spatial, y_spatial, current_frame_data); % Display the 2D image
        
        % Set consistent axis properties for stable visualization in the movie
        axis(hAx, 'xy', 'equal', 'tight'); % 'xy' for standard image orientation, 'equal' aspect ratio, 'tight' limits
        colorbar(hAx); % Show colorbar
        
        % Set consistent colorbar limits across all frames.
        % A unit impulse peak is 1. Sidelobes can go slightly negative (Gibbs phenomenon).
        caxis(hAx, [-0.2 1.1]); % Adjusted to accommodate slight undershoots and overshoot

        % Update the plot title to show current progress (number of harmonics added)
        title(hAx, sprintf('Summing 2D Harmonics: Frequencies Added = %d (fx from 0 to %d)', fx_val + 1, fx_val));
        xlabel(hAx, 'Spatial X-coordinate (radians)');
        ylabel(hAx, 'Spatial Y-coordinate (radians)');
        
        drawnow; % Force MATLAB to update the figure window immediately

        % Capture the current figure as a frame
        frame = getframe(hFig);
        
        % Write the captured frame to the video file
        writeVideo(writerObj, frame);
    end
end

% REPLACE_WITH_DASH_DASH- Finalize Movie REPLACE_WITH_DASH_DASH-
close(writerObj); % Close the video writer object
fprintf('Movie creation complete. File saved as: %s\n', outputVideoFile);

% REPLACE_WITH_DASH_DASH- Optional: Display the final reconstructed impulse line in a separate figure REPLACE_WITH_DASH_DASH-
% This plot shows the final state of the summation, identical to the last frame of the movie.
figure; % Create a new figure for the final plot
final_impulse_image = real(accumulated_harmonics_2D / (N*N)); % Final scaling and taking real part

imagesc(x_spatial, y_spatial, final_impulse_image);
axis xy equal tight;
colorbar;
title(['Final Reconstructed 1D Impulse Line (N=' num2str(N) ' Harmonics)']);
xlabel('Spatial X-coordinate (radians)');
ylabel('Spatial Y-coordinate (radians)');
caxis([-0.2 1.1]); % Match movie's colorbar limits

fprintf('Maximum value of final reconstructed image: %f\n', max(final_impulse_image(:)));
fprintf('Minimum value of final reconstructed image (excluding peak): %f\n', min(final_impulse_image(final_impulse_image < 0.5)));
##### SOURCE END #####
-->
</div></body></html>