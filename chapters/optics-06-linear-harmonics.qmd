# Linear optics - harmonics {#sec-optics-linear-harmonics}
Until now, we have analyzed optical systems using point-based stimuli (impulses and point spread functions). As discussed in @sec-appendix-linear-systems, this is only one of many useful signal representations. In this section, we introduce an alternative: image harmonics (sinusoidal patterns). Harmonic representations are common in the imaging literature for both theory and measurement because they align naturally with how many optical systems behave.

There are two practical motivations. First, while the point spread function is fundamental, it is not always the most convenient tool for predicting how finely a system can resolve detail; spatial resolution is often easier to analyze in the frequency domain using harmonics. Second, point stimuli are photon-inefficient and difficult to measure precisely. Extended sinusoidal targets deliver more light, produce higher signal-to-noise measurements, and allow precise control of spatial frequency, orientation, and phase.

The next section defines image harmonics and shows how to use them to characterize system performance. The mathematical foundations appear in @sec-ls-appendix. In brief: for linear, shift-invariant systems, harmonics form a spatial basis for arbitrary stimuli (@sec-ls-spatial-basis) and act as eigenfunctions of the system (@sec-ls-eigenfunctions). These properties make harmonics especially valuable for analysis, design, and for defining measures such as the modulation transfer function (MTF).

## Image harmonics {#sec-optics-harmonics}
Harmonics are a convenient way to model and measure imaging systems. For real-valued signals—such as light intensity—the basic building blocks are the sine and cosine functions. You likely first met these as one-dimensional functions: they take a single input and produce a single output.

$$
I(x) = \sin(2\pi f_x x + \phi_x)
$${#eq-harmonics-1d}

Here, $f_x$ is the spatial frequency (in cycles per unit distance) and $\phi_x$ is the phase (a horizontal shift).

In imaging, we typically need a two-dimensional representation to describe variation across both $x$ and $y$. A useful form that keeps intensities non-negative is

$$
I(x,y) = M\big(1 + A \sin(2\pi f_x x + \phi_x + 2\pi f_y y + \phi_y)\big).
$${#eq-harmonics-2d}

- $M$ is the mean (DC) intensity.
- $A$ is the contrast or modulation depth. To ensure $I(x,y) \ge 0$, we require $|A| \le 1$. In practice, we often take $A \in [0,1]$ and absorb any sign into the phase.
- The pair $(f_x, f_y)$ is the 2D spatial frequency. When both are nonzero, the pattern has an orientation; the bars are perpendicular to the vector $(f_x, f_y)$, with angle $\theta = \mathrm{atan2}(f_y, f_x)$.

@fig-optics-harmonics-2d shows four image harmonics. When $f_y = 0$ the pattern is vertical (varies only along $x$); when $f_x = 0$ it is horizontal (varies only along $y$).[^spatial-frequency]

[^spatial-frequency]: Different fields use different terminology. Vision scientists often call these spatial frequency gratings. Engineers sometimes approximate sinusoidal patterns with evenly spaced bars or lines. We use the term harmonics.

![Harmonic images. These have different $f_x$ and $f_y$ values, but all have contrast $A=1$. The image is vertical if $f_y = 0$ and horizontal if $f_x = 0$.](images/optics/optics-harmonics.png){#fig-optics-harmonics-2d width="80%"}

For many linear-systems principles, it is enough to consider one-dimensional harmonics by fixing $f_y = 0$. The examples in @fig-optics-harmonics-1d vary only along $x$ and illustrate different spatial frequencies $f_x$ and contrasts $A$.

![A set of one-dimensional image harmonics. They vary in $x$ with $f_y = 0$. The contrast $A$ varies from top to bottom $(1, 0.5, 0.1)$. The $x$-range is $(0,1)$, and the spatial frequencies are $f_x = (1, 2, 4, 8)$.](images/optics/optics-harmonics-1d.png){#fig-optics-harmonics-1d width="60%"}

## Harmonics and space {#eq-optics-harmonics-space}
Around 1805, **Jean Baptiste Joseph Fourier** discovered that most of the functions we encounter in daily life can be expressed as the weighted sum of harmonics. This surprised, or perhaps annoyed, the mathematicians of the French academy [see the historical note](#fourier-history). 

To many people it is counterintuitive that a thin line can be constructed by summing harmonics, each of which extends across the entire image. How does the combination of these broad functions result in a localized feature like a line? 

@fig-optics-reconstruction provides insight into this process. The figure shows how the image evolves as we sum increasing numbers of harmonics: starting with just a few, the result is broad and diffuse, but as more harmonics are added, the image becomes increasingly concentrated. The key is that the positive and negative regions of the harmonics cancel each other out everywhere except at the center, where all the cosine terms are positive ($\cos(0)$). With enough harmonics, the sum converges to a single, sharp line.

In this example, we reconstruct a line at the center (column 65) of a 129-column image by setting all harmonic weights to $w_f = 1$. Because the target image is even symmetric, only the cosine terms are needed. The red traces in the figure show the intensity profile: as more harmonics are added, the central peak narrows and side ripples diminish. By the 64th harmonic, the line is well-formed; adding more harmonics briefly reintroduces some ringing, which disappears when the full set is included. This phenomenon is a classic result in linear systems—ask your instructor for more details!

![Summing harmonics to become a line. The panels show the sum of the first 4, 16, 64, 72, and finally all 128 harmonics. To match a single line in the middle (col=65) of this 129 column image, the weights of each harmonic are all $w_f = 1$. Because the image is even symmetric, we need to sum only the $cos()$ terms. The red traces superimposed on the images are the intensity. The central region becomes thinner and the ripples on the side are eliminated by the 64th harmonic.  They return as we keep going to f = 72, but are eliminated again at f=128.  Ask your linear systems instructor about this; s/he will like you for it.](images/optics/optics-reconstruction.png){#fig-optics-reconstruction width="100%"}

::: {.callout-note collapse="true" title="Line reconstruction: the movie"}
This movie illustrates how the sum converges as harmonics are added one by one. Initially, the harmonics are distributed across the image. As more are included, their contributions cancel everywhere except at the central position ($0$), where all are positive ($\cos(0)$). 

Adding harmonics from $f=0$ to $f=64$ produces the line; adding $f=65$ to $f=128$ introduces some ringing, which is eliminated when the sum is complete. This is a special case for even symmetric functions, where only cosines are required.

![A line reconstructed by adding many harmonics at different frequencies. ](images/optics/lineReconstruct.mp4){#fig-optics-reconstruction-movie width="60%" fig-align="center"}

:::

## Discrete Fourier Series {#sec-optics-fourier-series}
The **Fourier series** represents functions as sums of harmonics. The Fourier series can be written in several equivalent forms. What follows are three common representations. 

In these formulae, rather than using $I(x)$, which implies $x$ is a continuous variable, we use $I[n]$ to signify that we are sampling at discrete points. For that reason, these formulae represent the **Discrete Fourier series**

**1. Sine and Cosine Form**

$$
I[n] = \frac{a_0}{2} + \sum_{f=0}^{N-1}  s_f \sin(2 \pi f n ) + c_f \cos(2 \pi f n)
$$ {#eq-fourier-series}

**2. Amplitude and Phase Form**

$$
I[n] = \frac{a_0}{2} + \sum_{f=0}^{N-1}  a_f \sin(2 \pi f n + \phi_f)
$$ {#eq-fourier-series-phase}

**3. Complex Exponential Form**

$$
I[n] = \sum_{f=0}^{N-1} w_f \, e^{i 2 \pi f n / N}
$$

where $w_f$ are complex numbers ($i = \sqrt{-1}$).

### Calculating the weights: Discrete Fourier transform
To analyze images using the Discrete Fourier Series, we need a way to transform the sampled image intensities, $I[n]$, into the Fourier weights, $w_f$. The most common method is the **Discrete Fourier Transform (DFT)**:
$$
w_f = \frac{1}{N} \sum_{n=0}^{N-1} I[n] \, e^{-i 2 \pi f n / N}
$$ {#eq-discrete-fourier-transform}

At first glance, this formula might look intimidating, but it's actually quite elegant. On the right, we have the sampled image values multiplied by a complex exponential. Thanks to **Euler's formula**, we know that any complex exponential can be written in terms of sine and cosine:

$$
e^{i\theta} = \cos(\theta) + i\sin(\theta).
$$ {#eq-Eulers-formula}

This means the DFT is really just combining the familiar sine and cosine terms into a single, compact expression using complex numbers. Many people find this complex formulation neater than keeping track of separate sine and cosine coefficients.

It's important to note that while $I[n]$ is real-valued, the DFT coefficients $w_f$ are generally complex. For a real signal, there is redundancy: the coefficients satisfy $w_{f} = \overline{w_{N-f}}$, where $\overline{w_f}$ is the complex conjugate of $w_f$.[^dft-coefficients]

[^dft-coefficients]:  The complex conjugate of $a + i b$ is $a - i b$.

If you prefer to work with real numbers, you can compute the sine and cosine coefficients, $s_f$ and $c_f$, directly from the image intensities:

$$
\begin{align}
a_0 &= \frac{2}{N} \sum_{n=0}^{N-1} I[n] \\
s_f &= \frac{2}{N} \sum_{n=0}^{N-1} I[n] \sin\left(\frac{2\pi f n}{N}\right) \\
c_f &= \frac{2}{N} \sum_{n=0}^{N-1} I[n] \cos\left(\frac{2\pi f n}{N}\right)
\end{align}
$$

Here, $a_0$ gives twice the mean value of $I[n]$, which is why the Discrete Fourier Series (@eq-fourier-series) starts with $\frac{a_0}{2}$.

## Relating the DFS representations

There are several equivalent ways to write the Discrete Fourier Series, and it's helpful to know how the parameters relate:

- $\frac{a_0}{2}$ and $w_0$ both represent the mean value of the signal $I[n]$.

- The amplitude and phase parameters relate to the sine and cosine coefficients as follows:

$$
\begin{align}
a_f & = \sqrt{{s_f}^2 + {c_f}^2} \\
\phi_f & = \arctan\left(\frac{c_f}{s_f}\right)
\end{align}
$$

- The complex weights $w_f$ are related to the sine and cosine coefficients by

$$
w_f  = \frac{1}{2} (c_f - i s_f ) \qquad \text{for } f > 0
$$

- And the complex weights $w_f$ are related to the amplitude and phase by

$$
w_f = \frac{a_f}{2} e^{i (\phi_f - \pi/2)} \qquad \text{for } f > 0
$$

So, whether you prefer to think in terms of sines and cosines, amplitudes and phases, or complex exponentials, you can always translate between these forms.

::: {.callout-note title="About Jean Baptiste Joseph Fourier" collapse="false" #fourier-history}
Here is a link to a nice website with a  <a href="https://mathshistory.st-andrews.ac.uk/Biographies/Fourier/" target="_blank">biography of Fourier and many others</a> . The material below is extracted from that site and wikipedia.

:::{.columns}

::: {.column width="50%"}
- Son of a tailor
- Orphaned at 9
- Educated by Benedictines
- Promoted the French Revolution
- Accompanied Bonaparte as scientific adviser to Egypt
- Appointed Governor near Grenoble
- A statue of Fourier, in Grenoble, was melted down for armaments!
:::

::: {.column width="50%"}
![Jean Baptiste Joseph Fourier](images/optics/optics-fourier.png){#fig-optics-fourier width="80%"}
:::
:::

While serving as Governor in Grenoble, Fourier made his major mathematical contributions to the theory of heat. He began this work around 1804, and by 1807 had completed his influential memoir, "On the Propagation of Heat in Solid Bodies." Fourier presented this memoir to the Paris Institute on December 21, 1807, where a committee of prominent mathematicians—Lagrange, Laplace, Monge, and Lacroix—was assigned to review it. Although the memoir is now highly regarded, it was controversial at the time.

The committee had two main concerns. First, Lagrange and Laplace objected to Fourier's use of trigonometric series to expand functions—what we now call Fourier series. Despite further explanations from Fourier, they remained unconvinced. As noted by J. Herivel in his biography of Fourier:

> All these are written with such exemplary clarity—from a logical as opposed to calligraphic point of view—that their inability to persuade Laplace and Lagrange ... provides a good index of the originality of Fourier's views.

Second, Biot criticized Fourier's derivation of the equations for heat transfer, noting that Fourier did not reference Biot's 1804 paper on the topic. However, Biot's paper was later shown to be incorrect. Laplace and Poisson also raised similar objections.

In 1811, the Institute announced a prize competition on the propagation of heat in solid bodies. Fourier submitted his 1807 memoir along with additional work on the cooling of infinite solids and on terrestrial and radiant heat. Only one other entry was received. The prize committee—Lagrange, Laplace, Malus, Haüy, and Legendre—awarded Fourier the prize.

However, their report was mixed, stating: “... the manner in which the author arrives at these equations is not exempt of difficulties and that his analysis to integrate them still leaves something to be desired on the score of generality and even rigour.” As a result, there was no immediate move in Paris to publish Fourier's work.
:::


## Two-dimensional Fourier Transforms

Say something

::: {.callout-notes title='2D Fourier Transforms' collapse='false'}

Some words.

[Link to Google resource.](resources/history-2D-fourier-transform.html){target=_blank}

Some more words

:::

Not sure how much to add.  But separability might be good.  And the formulae.



