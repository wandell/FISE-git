# Thin lenses {#sec-optics-thinlens}
Many image system properties can be summarized by the geometric optics of ray tracing. This analysis characterizes important performance characteristics of an optical system, such as its focal length, magnification, and depth of field. These optical properties can be analyzed in a particularly simple and clear way if we consider very simple thin lenses. 

Starting with an analysis of a thin lens has much practical value. First, many people, including both engineers and photographers, rely on the thin lens ideas when they describe optical system characteristics. Familiarity with these ray trace characterizations is important for anyone working in the field of image systems engineering. Second, even more complex image systems are often made from lenses that are well approximated by a collection thin lenses. We will go on to see how to extend the thin lens ideas to more complex systems in @sec-optics-morelenses.

This section explains ways to understand image system optics by ray tracing. Important as it is, ray tracing is not up to the task of a full image systems simulation. As we saw in @sec-optics-geometric, we will need to account for the wave properties of light, for example to incorporate diffraction. We will explain the methods used for simulating the spectral irradiance at the sensor in subsequent chapters about linear systems (@sec-optics-linear) and wavefront calculations (@sec-optics-wavefront). 

## What is a thin lens {#sec-optics-thinlensdefined}

If a lens width is much smaller than the *radius of curvature* of its two surfaces, it is called a *thin lens*. The radius of the circle that (at least approximately) conforms to the surface of the lens is the radius of curvature. There is no universally agreed upon numerical value for what is meant by much smaller, but it is common to consider a lens whose width is one-tenth or less of the radius of curvature to be a thin lens.

![(a) This lens width is smaller than the radius of the circle that matches its surface. The lens might be considered thin. (b) This lens width is approximately equal to the radius of curvature. It is not be a thin lens.](images/optics/thinlens-definition.png){#fig-thinlens-definition fig-align="center" width="60%"}

## Focal points {#sec-optics-focalpoints}

@fig-thinlens-focalpoints shows the important concept of the primary and secondary focal points of a convex and concave thin lens. The primary focal point (F) is the location on the optical axis such that any ray coming from it towards the lens travels parallel to the axis after refraction. The distance from that point to the middle of the lens is called the *focal length*. The secondary focal point The secondary focal point (F') is the axial point such that any incident ray traveling parallel to the axis will, after refraction, proceed toward, or appear to come from it. The secondary focal point has its own focal length.

![(a) The primary (F) and secondary (F') focal points of a convex (left) and concave (right) thin lens. Read the diagram with the light rays (dark, solid lines) traveling from left to right. The dashed lines drawn on the concave lens are virtual rays that are shown to clarify how the focal point is found. See the text for an explanation.](images/optics/thinlens-focalpoints.png){#fig-thinlens-focalpoints fig-align="center" width="100%"}

When examining the behavior of an equiconvex lens, two primary scenarios emerge. In the first scenario, rays emanating from the primary focal point (F) enter the lens and are refracted in such a way that they exit traveling parallel to the main optical axis. Conversely, when parallel rays enter the lens, they are refracted and converge towards the secondary focal point (F'), demonstrating the lens's ability to redirect light.

The equiconcave lens presents a contrasting optical behavior. When incident rays enter the lens at various angles with the intention of producing parallel rays, these rays converge at the primary focal point (F) on the opposite side of the lens. Dashed lines can be used to trace and illustrate this convergence. In a separate scenario, when parallel rays enter the equiconcave lens, they diverge after refraction. If these diverging rays are extended backward using dashed lines, they appear to originate from the secondary focal point (F') on the opposite side of the lens.

## Biconvex lenses {#sec-optics-biconvex}

![Different radii of curvature for a thin lens.](images/optics/thinlens-asymmetric.png){#fig-thinlens-asymmetric fig-align="center" width="60%"}

The lenses drawn in @fig-thinlens-focalpoints are symmetric (i.e., equiconvex and equiconcave). It is not surprising, therefore, that the focal lengths of the primary and secondary focal points are equal. It is more surprising to learn that even if the thin lens has a different curvature on the two sides, the two focal lengths will still be equal [@fig-thinlens-asymmetric]. We will explain this after we introduce the lensmaker's equation, below.

There are many other useful calculations that one can explore with simple lenses and ray tracing. Here, we cover the very basics to give the reader some of the terminology and a sense of how these systems are analyzed. For a deeper dive, I suggest the reader look into some of the excellent textbooks on optics (References here. Usually Goodman; Born and Wolf; I like Jenkins and White.)

## Three ray trace principles {#sec-optics-3principles}
Consider the vector object on the left of @fig-lensmaker-center. A ray from the arrowhead that is parallel to the axis will be refracted through the focal point. A ray from origin of the vector, which is on the optical axis, will also pass through the focal point. Finally, a ray from the arrowhead - and this is new - that passes through the center of the lens will continue on a straight path.

![Tracing an object through the lens to an image.](images/optics/lensmaker-center.png){#fig-lensmaker-center fig-align="center" width="70%"}

In summary, rays that

-   Enter parallel to the optical axis and pass through the focal point on the opposite side.
-   Pass through the center of the lens do not deviate (refract).
-   Pass through the primary focal point toward the lens exit parallel to the optical axis.

## Image plane {#sec-optics-imageplane}
They rays from a distant point off the optical approach the entrance as parallel to one another but oblique to the optical axis. The ray that passes through the center of the lens is called the *chief ray*. There will also be a ray that passes through the primary focal point. It will be refracted by the lens and emerge as parallel to the optical axis. These two rays intersect where the image of the point will be formed.

![The image plane for distant points is perpendicular to the optical axis and passes through the secondary focal point (blue dashed line).](images/optics/thinlens-obliquerays.png){#fig-optics-focalplane fig-align="center" width="70%"}

```{=html}
<!-- 
We need to establish the image plane.  Oblique parallel rays.  The chief ray angle.  This book (a pressbook!) does a nice job.
https://pressbooks.online.ucf.edu/osuniversityphysics3/chapter/thin-lenses/?t 
-->
```

## Lens power (diopters) {#sec-optics-lenspower}

The *power* of a lens is the inverse of the focal length, in meters. The unit for lens power, $1/m$ is the *diopter*. A short focal length implies large power, either due to the curvature of the lens surface or the refractive index of the lens material.

![Lens power is the inverse of focal length. The unit of lens power is diopter.](images/optics/lensparameters-power.png){#fig-thinlens-power fig-align="center" width="80%"}

To measure the focal length of a lens we use a light source that produces parallel rays at the entrance aperture of the lens. We then slide the image plane back and forth, searching for the distance where the spot is smallest. We can create parallel rays using many methods. Perhaps the simplest is to use a small point source (e.g., an LED) at a distance from the lens. The rays arriving at the lens will be a small angular sliver of the emitted rays, and if the source is far from the lens the rays will be very close to parallel (e.g., @fig-pinhole-basic). An alternative, is to go outside on a sunny day and use the sun as a source. The sun isn't small, but it is really far away. By the time the rays from the disk of the sun arrive at your lens, the rays will be parallel.

The optics in the human eye has multiple elements. Even so, we can measure its focal length, which is about 0.016 m (\~60 diopters). To bring objects at different distances into focus the optics adjusts its power, a process called *accommodation*. If it cannot adjust adequately, we wear lenses (glasses, contact lenses) that increase or decrease the optical power, say by 1-8 diopters, so that a good image can be focused on the retina.

Young people can accommodate easily. As people age, we lose the ability to change the optical power of the optics, a condition called *presbyopia*. This happens to everyone. This biological fact is a consideration for the design of near field displays (@sec-displays).

## The lens formula {#sec-lens-formula}
When an object is far away, the rays arriving at the lens are parallel. The image of the object will be in focus at the focal length. When the object is closer, we can use the *Lens formula* to find the plane where the object will be in focus. The equation, which was derived by Halley in 1693, relies on the three ray tracing properties of symmetric thin lenses (@sec-optics-3principles). Using these principles, we can locate where the object at a distance $d_o$ will be in focused on the image side; call that distance $d_i$.

![Similar triangles for the lens formula.](images/optics/lensmaker-similartriangles.png){#fig-lensmaker-similartriangles fig-align="center" width="95%"}

The rays in @fig-lensmaker-similartriangles identify two pairs of similar triangles (cyan and yellow). On the left, we can see that the triangles imply $h_i/h_o = d_i/d_o$. On the right, we can see that the triangle similarity implies $h_i/h_o = \frac{d_i - f}{f}$. Combining the two equalities, we have

$$\frac{d_i}{d_o} = \frac{d_i - f}{f} = \frac{d_i}{f} - 1 $$

rearranging terms, 
$$ 
\frac{d_i}{f}  = 1 + \frac{d_i}{d_o} 
$$

and dividing by $d_i$ we have the lens formula

$$ 
\frac{1}{f}    = \frac{1}{d_i} + \frac{1}{d_o} 
$$ {#eq-lensformula}

The common names for these variables are

*  $d_o$ - **Object distance**
*  $d_i$ - **Image distance**
*  $f$   - **Lens focal length**
  
## Image distance {#sec-optics-imagedistance}

For a lens with focal length $f$, @eq-lensformula defines the relationship between the object distance and the image distance, where the object is in best focus. Notice that when $d_o = \infty$, then $d_i = f$. We can re-write the formula to calculate this distance explicitly. 

$$
\frac{-1}{d_i} = \frac{1}{d_o} - \frac{1}{f}
$$ 
$$
d_i =  \frac{1}{\frac{1}{f} - \frac{1}{d_o}}
$$ 
$$
d_i = \frac{f~d_o}{d_o - f} 
$$

You can see from [@eq-imagedistance] that as $d_o$ becomes much larger than $f$, $d_i$ becomes approximately $f$. Specifically, if we express $d_o$ in terms of the focal length of the lens, $k f$, we have

$$
d_i = \frac{f k f}{(k-1) f} = f \frac{k}{k-1}
$$ {#eq-imagedistance}

This script plots the image distance as a function of object distance expressed as a multiple of focal length.

## Lensmaker equation {#sec-optics-lensmaker}

The lens formula computes the image distance for a lens of known focal length. How do we calculate the focal length of a thin lens? There is a formula we can use to calculate the focal length of a thin lens with (a) both sides approximately spherical, and (b) embedded in a homogeneous environment.

Suppose the refractives index of the lens is $n_2$ and of the surrounding medium is $n_1$. Suppose that the radius of curvature of the first surface is $R_1$ and the second surface $R_2$. The formula for the focal length is

$$\frac{1}{f} = (\frac{n_2}{n_1} - 1) ( \frac{1}{R_1} - \frac{1}{R_2}) $$ {#eq-lensmaker}

Notice that flipping the shape of the lens, so that $R_2$ and $R_1$ exchange, the magnitude of the focal length remains the same; it just changes sign. So the magnitude of the primary and secondary focal lengths are the same for such thin lenses.

Here is a link to a very nice [video derivation of the formula](https://www.khanacademy.org/science/in-in-class-12th-physics-india/in-in-ray-optics-and-optical-instruments/in-in-refraction-in-thin-lenses/v/lens-makers-formula).

## The $f/\#$ (f-number) {#sec-optics-fnumber}

The $f/\#$ of a thin lens is the ratio of its focal length and entrance aperture diameter (@fig-fnumber). For example, when we write f/4, it means that the focal length is 4x the aperture diameter.

![Graphic of the $f/\#$.](images/optics/lensparameters-fnumber.png){#fig-fnumber fig-align="center" width="50%"}

The $f/\#$ is an important parameter for all thin lenses, and it appears in many formulae. It is the only free parameter of a circular, diffraction-limited thin lens. This is an important case for assessing system performance because it represents an upper bound on lens performance. If we simulate performance of a system assuming diffraction-limited optics, we cannot improve the system by using better optics.

As an example, the Airy disk diameter (meters) on the image plane of a diffraction limited lens depends only on the wavelength of light and the f/# of the lens. If the wavelength is $\lambda$ and f/# is $N$, the formula for the Airy disk diameter is

$$ d = 2.44 ~ \lambda ~ N$$ {#eq-airy2}

If you revisit the first calculation of the Airy disk, in @sec-lightfields-diffraction, you will see that this formula is implicit in how we modeled the image from a diffraction limited pinhole [@eq-airy1].

## Magnification and zoom {#sec-optics-zoom}

Consider the simple thin lens in @fig-optics-magnification with a image distance of $f = 0.1m$. We draw the rays to the image plane for an object at a distance of $d_o = 0.3m$.

![Ray tracing lenses with different focal lengths. Suppose focal length of the lens in the bluish box is $0.1 m$ and the distance to the object as $0.3m$. And suppose the focal length in the greenish box is $0.2 m$.](images/optics/lensparameters-magnification.png){#fig-optics-magnification fig-align="center" width="90%"}

Using the lens formula, the image distance for the lens in the bluish box is

$$d_i = \frac{f \times d_o}{d_o - f} = \frac{0.1 \times 0.3}{0.3 - 0.1} = 0.15 m$$

The image distance for the lens in the greenish box, with twice the focal length, $f' = 0.2m$, is

$$d_{iL} = \frac{0.2 \times 0.3}{0.3 - 0.2} = 0.60 m$$.

The image distance and image size both increase by a factor of $4$. The two lenses have the same entrance aperture, so they capture the same amount of light. Because the longer focal length lens spreads the image over a larger area, the amount of light per unit area (irradiance) in the image is reduced.

Some camera optics with an adjustable focal length, and this enables the user to adjust the image magnification. The image sensor size, however, is usually fixed. Thus, if we increase the image magnification, the fixed sensor captures a smaller portion of the image, but with the same sensor spatial resolution. The effect is to produce an image that appears to zoom into a portion of the image. This technique, called **optical zoom** is very effective as long as there is no loss of spatial resolution in the magnified image.

![Optical zoom. (a) A small image that just fits onto the sensor (dashed lines). (b) If we magnify the image, say by increasing the focal length and image distance, the sensor measures a smaller portion of the image. This is optical zoom.](images/optics/lensparameters-zoom.png){#fig-optics-zoom fig-align="center" width="80%"}

## $F/\#$ and image intensity {#sec-optics-fnumberintensity}

Suppose we wish to magnify the image, but we want to maintain the image irradiance level. In that case, we must capture $4$ times as much light. We do this by increasing the lens diameter, $D$. The formula for the area of the aperture is $\pi (D/2)^2$; thus, doubling the $D$ increases the area by a factor of $4$.

The size of the lens with the larger diameter is sketched by the dashed ellipse in the green section of @fig-optics-magnification. Increasing the focal length expands the image size and reduces the image intensity. Increasing the lens diameter compensates for the reduced intensity. Doubling the focal length and entrance diameter preserves the f/# (ratio of the focal length and the aperture diameter). This example illustrates that lenses with the same f/# produce images with the same image intensity.

## Depth of field {#sec-optics-dof}
@eq-imagedistance tells us how to set the distance between the optics and image plane, $d_i$, to bring an object at distance $d_o$ into focus.  We might also be interested to answer the related question:  Given that an object at $d_o$ is in focus, what will the blur be for objects nearer or further? The range of distances over which the objects remain in good focus is called the **depth of field**.

The size of the depth of field can be controlled by adjusting the size of the lens aperture.  As it becomes smaller, the lens becomes closer to a pinhole, the depth of field increases.  The depth of field can become quite narrow for a large aperture. Controlling the depth of field can create visually interesting images (@fig-optics-bokeh). Photographers and cinematographers often use settings to bring the main object of interest into good focus and blurring the rest. The depth of field is a quantitative description of the lens setting.  Photographers use the term **bokeh** to describe the aesthetic impact one can achieve by adjusting the depth of field. This quality depends on the optics as well as the scene contents.

![The depth of field is controlled by the size of the lens aperture.  (A) Photographers often adjust the depth of field to bring the main object into focus, allowing other parts of the scene to become defocused.  (B) If we fix the image distance, increasing the $f/\#$ decreases the aperture, making the lens increasingly like a pinhole camera. For a large $f/\#$, the depth of field becomes quite larger.](images/optics/optics-bokeh.png){#fig-optics-bokeh width="80%"}

<!--
https://en.wikipedia.org/wiki/Depth_of_field
http://www.rags-int-inc.com/PhotoTechStuff/DoF/
http://www.rags-int-inc.com/PhotoTechStuff/DoF_Calculator/DoF_Calculator.html
-->

### Circle of confusion {#sec-optics-coc}
Consider an image formed with a thin lens that is kept at a fixed distance from the image plane (@fig-optics-coc1).  The middle image panel an object in excellent focus, and the other two panels show points that are too near or too far. As the point moves away from the in-focus object distsance, in either direction, the image will be a roughly circular region increases in diameter.  This is the circle of confusion. This is the **circle of confusion**.  It is a useful concept that is specifically helpful for understanding and quantifying the depth of field. 

![Circle of confusion](images/optics/optics-coc-1.png){#fig-optics-coc1 width="60%"}

Consider the effect of narrowing the aperture (@fig-optics-coc2).  The angle of the rays arriving at the sensor

![Narrowing the aperture changes the angular range of the rays at the image plane.  By reducing the angle, we reduce the diameter of the circle of confusion.](images/optics/optics-coc-2.png){#fig-optics-coc2 width="60%"}

We can calculate the size of the circle of confusion for different lenses using the ISETCam function [opticsCoC](https://github.com/iset/ISETCam/blob/main/opticalimage/optics/opticsCoC.m){target="_blank"}. The script [s_opticsCoC](https://github.com/iset/ISETCam/blob/main/scripts/optics/s_opticsCoC.m){target="_blank"} compares the circle of confusion for two lenses with the same image distance but different apertures. 

<!-- s_opticsCoC.m -->
![Narrowing the aperture reduces the size of the circle of confusion. Notice that the vertical axis is logarithmic, so that the change in diameter is substantial. Both lenses have a 50 mm distance to the image plane.  One lens has an $f/\#$ of 2 (aperture=25 mm).  The other lens has an $f/\#$ of 8 (aperture=6.25 mm).](images/optics/optics-coc-3.png){#fig-optics-coc3 width="60%"}

Suppose we select a circle of confusion diameter that we consider to be good focus. From the curves in @fig-optics-coc3, the range of good focus depths will be narrower for the large aperture than the small aperture.  What formula might we use to 

### Formula for depth of field

![Graph showing DOF as a function of f/#.](images/optics/optics-coc-1.png){#fig-optics-dof width="60%"}

$$
\text{DOF} \approx \frac{2 (N) C U^2}{f^2}
$$ {#eq-optics-depthoffield}

-   $N$ - Lens $f/\#$ (dimensionless)
-   $C$ - Diameter of the circle of confusion (m)
-   $U$ - Distance to the subject in object space (m)
-   $f$ - Lens focal length (m)

