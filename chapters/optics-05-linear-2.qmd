# Optical transfer functions {#sec-optical-transfer}
It is easy to think of images as a set of points. It is an important insight, however, to realize that an image can be described in other ways. Some of these alternative image representations are valuable for analyzing optical performance in an the image system.

An important general approach for creating alternative representations is to linear models. We introduced linear models in @sec-linear-models, and we applied them to characterizing the spectral properties of light fields. Here we will be using linear models again, but in a different way.  In this case we create linear models of the image intensity spatial distribution, $I(x,y)$. The model will be useful for characterizing the properties of an optical system. 

A general linear model of the image intensity can be written this way:

$$
I(x,y) = \sum_{i} w_{i} B_{i}(x,y)
$$

The functions $B_{i}(x,y)$ are the **spatial basis functions**, and the scalar values $w_{i,j}$ are the weights. The model represents the image as the weighted sum of these basis functions. In general, but not always, we select basis functions that are orthogonal to one another, 

$$
0 = \sum_{x,y} B_i (x,y) B_j (x,y).
$$ {eq-spatial-orthogonal}

These models are also called an **image decompositions**, because we consider the linear model as decomposing the original image into these basis functions. Linear models important in image systems, and they are important in science and engineering broadly. Of all the linear models, the decomposition into the weighted sum of harmonic functions has been the most important. 

## Harmonics {#sec-optics-harmonics}
For real-valued signals - such as light intensity - the harmonic functions are the *Sine* and *Cosine*. In typical use, *Sine* and *Cosine* are one-dimensional functions.  But in image systems applications we express them as two-dimensional images

$$
I(x,y) = M(1 + A sin(2\pi f_x x + \phi_x + 2 \pi f_y y + \phi_y)) .
$${#eq-harmonics-2d}

The harmonic mean is $M$ and its **contrast** is $A$. Because image intensities are always positive, for any realizable image $A$ be within the range $[-1 1]$. @fig-optics-harmonics-2d shows four examples of **image harmonics**, each with a different pair of frequencies $f_x$ and $f_y$.  When both $f_x$ and $f_y$ are non-zero, the image appears to be a slanted harmonic.  When one of the two is $0$, the image will be a vertical ($f_y = 0$) or horizontal ($f_x = 0$) grating pattern.

![Examples of harmonic images.](images/optics/optics-harmonics.png){#fig-optics-harmonics-2d width="100%"}

We can develop many of the principles of linear models using one-dimensional harmonic images. @fig-optics-harmonics-1d shows a set of spatial harmonics with different spatial frequencies $f_x$, $f_y = 0$ and a range of contrasts $A$. 

![These one-dimensional harmonics are of the form in @eq-harmonics-2d, but simplified so that $\phi_x = \phi_y = f_y = 0$. The contrast $A$ varyies from the top to bottom row $(1, 0.5, 0.1)$.  The x-range is $(0,1)$, and the frequencies are $f_x = (1,2,4,8)$](images/optics/optics-harmonics-1d.png){#fig-optics-harmonics-1d width="100%"}

### Fourier series
It was surprising for mathematicians to learn -around 1820- that most of the functions we encounter in daily life can be expressed as the weighted sum of harmonics. This is surprising because each individual harmonic is periodic, spanning the entire image width. How can the sum of such functions equal something as localized as a thin line?  

We can see this happen and get a bit of an intuition from the video in @fig-optics-reconstruction-movie. It shows a series of images as we add together different frequencies. Notice that the result becomes increasingly compact so that after a while adding these very extended images produces a single line! The reason is that the positive and negative parts of the harmonics start to cancel one another, leaving only the value at cos(0), which is positive and ends up forming the line.

![How summing harmonics add up to a line. The sum of the first 4, 16, 64, 96, and 128 harmonics. To match the impulse, we can sum only cos(). ](images/optics/optics-reconstruction.png){#fig-optics-reconstruction width="100%"}

::: {.callout-note collapse="true" title="Reconstruction movie"}
A movie showing how the sum converges as we add in the harmonics, one by one. At first, the harmonics are spread across the image.  As we add in more harmonics, the different frequency harmonics cancel one another at the locations apart from the central position at $0$ where they are all positive ($\cos(0)$). 

Adding in the first $0-64$ produces the line. The next $65-128$ brings back a little ringing, which goes away when the sum is complete.  This is a very special case of an even symmetric function.  We can do the calculation with just cosines.

![A line reconstructed by adding many harmonics at different frequencies. ](images/optics/lineReconstruct.mp4){#fig-optics-reconstruction-movie width="60%" fig-align="center"}

:::

There is a second way to think about the optical transformations. Rather than measure how the optics transforms points at different depths and visual field positions, we measure how the system transforms

**Jean Baptiste Joseph Fourier** had the important insight we can express most realistic functions -such as a 1-dimensional light pattern $I(x)$- as the weighted sum of harmonics. We write this idea as the **Fourier series**. 

$$
I(x) = \frac{a_0}{2} + \sum_f s_f \sin(2 \pi f x ) + c_f \cos(2 \pi f x)
$$ {#eq-fourier-series}

The first term, $\frac{a_0}{2}$, is the mean of the signal $I(x)$. For each frequency, $f$, there are two coefficients: the amplitudes $s_f$ and $c_f$. These terms represent the modulation of the signal around the mean.

Another way to write the Fourier series is to use only one type of harmonic, say the Sine, but to include a frequency-dependent phase. 

$$
I(x) = \frac{a_0}{2} + \sum_f a_f \sin(2 \pi f x + \phi_f)
$$ {#eq-fourier-series-phase}

In this form, the equation also has two parameters, an amplitude $s_f$ and phase $\phi_f$. The parameters these two representations are related by 

$$
\begin{align}
a_f & = \sqrt{{s_f}^2 + {c_f}^2} \\
\phi_f & = \arctan(\frac{c_f}{s_f})
\end{align}
$$

### Fourier series coefficients

The coefficients of the series are computed using the following integrals:

- Constant (mean) term:

  $$
  a_0 = \frac{1}{\pi} \int_{-\pi}^{\pi} f(x) \, dx
  $$

- Cosine (even) coefficients:

  $$
  a_f = \frac{1}{\pi} \int_{-\pi}^{\pi} f(x) \cos(2 \pi f x) \, dx
  $$

- Sine (odd) coefficients:

  $$
  b_f = \frac{1}{\pi} \int_{-\pi}^{\pi} f(x) \sin(2 \pi f x) \, dx
  $$

The coefficient $a_0$ in the Fourier series is **twice** the average (mean) value of the function over the interval.

$$
\text{Mean of } f(x) = \frac{1}{2\pi} \int_{-\pi}^{\pi} f(x)\, dx = \frac{a_0}{2}
$$

And that is why it appears divided by 2.

::: {.callout-note title="Joseph Fourier" collapse="true"}

Something about his story and the challenge of getting his work published.

![Jean Baptiste Joseph Fourier](images/optics/optics-fourier.png){#fig-optics-fourier width="60%"}

Maybe the criticism of his work.

:::

## Eigenfunctions - almost

Harmonics (like sine and cosine waves) are almost the “natural” patterns for linear systems—they’re close to being eigenfunctions. For imaging, they’re not quite perfect eigenfunctions because of phase shifts, but if you think of them as 2D vectors, they’re pretty close.

## Optical Transfer Function

## Modulation Transfer

## Contrast sensitivity


